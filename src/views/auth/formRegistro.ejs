<!-- Registro nueva cuenta -->
<!DOCTYPE html>
<html lang="en">

<head>
  <%- include('../layout/cabecera') %>
    <link rel="stylesheet" href="../assets/vendor/css/pages/page-auth.css" />
    <link rel="stylesheet" href="../assets/css/authStyles.css" />
</head>

<body>

  <div class="container-xxl">
    <div class="authentication-wrapper authentication-basic container-p-y">
      <div class="authentication-inner">
        <!-- Register Card -->
        <div class="card">
          <div class="card-body" style="border: solid; border-radius: 10px; border-color: blueviolet;">
            <!-- Logo -->
            <div class="app-brand justify-content-center">
              <a href="/" class="app-brand-link gap-2">
                <span class="app-brand-logo demo">
                  <img src="../assets/img/resources/incognito.ico" alt="Incognito app" width="30%">
                </span>
                <span class="app-brand-text demo text-body fw-bolder">Incognito UTN</span>
              </a>
            </div>
            <!-- /Logo -->

            <h4 class="mb-2 text-center">Registro</h4>
            <p class="mb-4 text-center">Crea una nueva cuenta y Ayuda a Evaluar</p>
            <!-- Alerta que solo se muestra en caso de error -->
            <% if (error) { %>
              <div class="alert alert-danger alert-dismissible" role="alert">
                <%= message %>
                  <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
              </div>
              <% } %>
                <form id="formAuthenticationRegister" class="mb-3" enctype="application/x-www-form-urlencoded"
                  action="/auth/register" method="post">
                  <div class="mb-3">
                    <label for="username" class="form-label">Nombre</label>
                    <input type="text" class="form-control" id="username" name="username"
                      placeholder="Ingresa tu nombre" autofocus />
                  </div>
                  <div class="mb-3">
                    <label for="lastname" class="form-label">Apellidos</label>
                    <input type="text" class="form-control" id="lastname" name="lastname"
                      placeholder="Ingresa tus Apellidos" autofocus />
                  </div>
                  <div class="mb-3">
                    <label for="fecha_nac" class="form-label">Fecha de nacimiento</label>
                    <input type="date" class="form-control" id="fecha_nac" name="fecha_nac"
                      placeholder="Ingresa tu fecha de nacimiento" autofocus />
                  </div>
                  <div class="mb-3">
                    <label for="email" class="form-label">Correo electrónico</label>
                    <input type="email" class="form-control" id="email" name="email" placeholder="Ingresa tu correo" />
                  </div>
                  <div class="mb-3 form-password-toggle">
                    <label class="form-label" for="password">Contraseña</label>
                    <div class="input-group input-group-merge">
                      <input type="password" id="password" class="form-control" name="password"
                        placeholder="&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;&#xb7;"
                        aria-describedby="password" />
                      <span class="input-group-text cursor-pointer"><i class="bx bx-hide"></i></span>
                    </div>
                  </div>
                  <div class="mb-3">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="terms-conditions" name="terms" />
                      <label class="form-check-label" for="terms-conditions">
                        Aceptar
                        <a href="#fullscreenModal" data-bs-toggle="modal" data-bs-target="">Terminos y condiciones</a>
                      </label>
                    </div>
                  </div>
                  <div id="validationAlert" class="alert alert-warning alert-dismissible" role="alert"
                    style="display: none;">
                    Por favor, completa todos los campos para registrarte.
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
                  <div id="passwordAlert" class="alert alert-info alert-dismissible" role="alert"
                    style="display: none;">
                    La contraseña debe tener al menos 8 caracteres, incluyendo mayúsculas, minúsculas y números.
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
                  <div id="termsAlert" class="alert alert-dark alert-dismissible" role="alert" style="display:none;">
                    Debes aceptar los términos y condiciones.
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                  </div>
                  <div class="d-flex justify-content-center">
                    <button class="btn btn-danger w-50 m-1" type="button" onclick="history.back();">
                      Cancelar
                    </button>
                    <button class="btn btn-primary w-50 m-1" type="submit">Registrar</button>
                  </div>
                  <div id="spinnerContainer" class="spinner-container" style="display: none;">
                    <div class="spinner-border text-primary" role="status">
                      <span class="visually-hidden">Cargando...</span>
                    </div>
                  </div>
                </form>

                <p class="text-center">
                  <span>¿Ya tienes una cuenta?</span>
                  <a href="/auth/login">
                    <span>Inicia Sesión</span>
                  </a>
                </p>
          </div>
        </div>
        <!-- Fullscreen Modal -->
        <div class="col-lg-4 col-md-6">
          <small class="text-light fw-semibold">Fullscreen</small>
          <div class="mt-3">


            <!-- Modal -->
            <div class="modal fade" id="fullscreenModal" tabindex="-1" aria-hidden="true">
              <div class="modal-dialog modal-fullscreen" role="document">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="modalFullTitle">Terminos y condiciones</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <p>
                      Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac
                      facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum
                      at eros.
                    </p>
                    <p>
                      Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis
                      lacus vel augue laoreet rutrum faucibus dolor auctor.
                    </p>
                    <p>
                      Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel
                      scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus
                      auctor fringilla.
                    </p>
                    <p>
                      Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac
                      facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum
                      at eros.
                    </p>
                    <p>
                      Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis
                      lacus vel augue laoreet rutrum faucibus dolor auctor.
                    </p>
                    <p>
                      Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel
                      scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus
                      auctor fringilla.
                    </p>
                    <p>
                      Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac
                      facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum
                      at eros.
                    </p>
                    <p>
                      Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis
                      lacus vel augue laoreet rutrum faucibus dolor auctor.
                    </p>
                    <p>
                      Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel
                      scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus
                      auctor fringilla.
                    </p>
                    <p>
                      Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac
                      facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum
                      at eros.
                    </p>
                    <p>
                      Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis
                      lacus vel augue laoreet rutrum faucibus dolor auctor.
                    </p>
                    <p>
                      Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel
                      scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus
                      auctor fringilla.
                    </p>
                    <p>
                      Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac
                      facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum
                      at eros.
                    </p>
                    <p>
                      Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis
                      lacus vel augue laoreet rutrum faucibus dolor auctor.
                    </p>
                    <p>
                      Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel
                      scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus
                      auctor fringilla.
                    </p>
                    <p>
                      Cras mattis consectetur purus sit amet fermentum. Cras justo odio, dapibus ac
                      facilisis in, egestas eget quam. Morbi leo risus, porta ac consectetur ac, vestibulum
                      at eros.
                    </p>
                    <p>
                      Praesent commodo cursus magna, vel scelerisque nisl consectetur et. Vivamus sagittis
                      lacus vel augue laoreet rutrum faucibus dolor auctor.
                    </p>
                    <p>
                      Aenean lacinia bibendum nulla sed consectetur. Praesent commodo cursus magna, vel
                      scelerisque nisl consectetur et. Donec sed odio dui. Donec ullamcorper nulla non metus
                      auctor fringilla.
                    </p>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">
                      Cerrar
                    </button>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Register Card -->
      </div>
    </div>
  </div>

  <script>
    document.getElementById('formAuthenticationRegister').addEventListener('submit', function (event) {
      event.preventDefault();
      // Obtener valores de los campos
      var username = document.getElementById('username').value.trim();
      var lastname = document.getElementById('lastname').value.trim();
      var fecha_nac = document.getElementById('fecha_nac').value.trim();
      var email = document.getElementById('email').value.trim();
      var password = document.getElementById('password').value.trim();
      var termsAccepted = document.getElementById('terms-conditions').checked;

      // Función para validar la contraseña
      /*function validarContrasena(contrasena) {
        var regex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)[A-Za-z\d]{6,}$/;
        console.log("Contraseña a validar:", contrasena);
        console.log("Expresión regular:", regex);
        var resultado = regex.test(contrasena);
        console.log("Resultado de la validación:", resultado);
        return resultado;
      }*/

      function validarContrasena(contrasena) {
        if (contrasena.length < 8) {
          return false;
        }
        if (contrasena.search(/[a-z]/) < 0) {
          return false;
        }
        if (contrasena.search(/[A-Z]/) < 0) {
          return false;
        }
        if (contrasena.search(/[0-9]/) < 0) {
          return false;
        }
        return true;
      }
      // Inicializar un indicador de error
      let error = false;


      // Validar si los campos están vacíos
      if (!username || !lastname || !fecha_nac || !email || !password) {
        // Mostrar alerta de validación
        document.getElementById('validationAlert').style.display = 'block';
        // Prevenir el envío del formulario
        event.preventDefault();
      } else if (!validarContrasena(password)) {
        document.getElementById('passwordAlert').style.display = 'block';
        // Prevenir el envío del formulario
        event.preventDefault();
      } else if (!termsAccepted) {
        // Mostrar alerta de términos y condiciones
        document.getElementById('termsAlert').style.display = 'block';
        // Prevenir el envío del formulario
        event.preventDefault();
      } else {
        // Ocultar las alertas y mostrar el spinner
        document.getElementById('passwordAlert').style.display = 'none';
        document.getElementById('validationAlert').style.display = 'none';
        document.getElementById('termsAlert').style.display = 'none';
        document.getElementById('spinnerContainer').style.display = 'flex';
        this.submit(); // Envía el formulario después de todas las validaciones
      }

    });
  </script>

  <!-- <script>
  document.getElementById('formAuthenticationRegister').addEventListener('submit', function(event) {
    // Mostrar el spinner
    document.getElementById('spinnerContainer').style.display = 'flex';
  });
</script> -->

  <script src="../assets/vendor/libs/jquery/jquery.js"></script>
  <script src="../assets/vendor/libs/popper/popper.js"></script>
  <script src="../assets/vendor/js/bootstrap.js"></script>
  <script src="../assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>

  <script src="../assets/vendor/js/menu.js"></script>
  <!-- endbuild -->

  <!-- Vendors JS -->

  <!-- Main JS -->
  <script src="../assets/js/main.js"></script>

  <!-- Page JS -->

  <!-- Place this tag in your head or just before your close body tag. -->
  <script async defer src="https://buttons.github.io/buttons.js"></script>
  <!-- / Content -->
</body>

</html>