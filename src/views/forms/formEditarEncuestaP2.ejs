                        <div class="modal fade" id="modalTogglEditar2" aria-hidden="true" aria-labelledby="modalToggleLabel2" tabindex="-1">
                        <div class="modal-dialog modal-dialog-centered">
                          <div class="modal-content">
                            <div class="modal-header">
                              <h5 class="modal-title" id="modalToggleLabel2">Parte 2</h5>
                              <button
                                type="button"
                                class="btn-close"
                                data-bs-dismiss="modal"
                                aria-label="Close"
                              ></button>
                            </div>
                            <form id="encpreg" >
                            <div class="modal-body">
                                    <div class="mb-3">
                                        <label for="categoriaSelec" class="form-label">Categoria</label>
                                        <select class="form-select" id="categoriaSelects" name="categoria">
                                          <option >Selecionar una categoria...</option>
                                          <% categorias.forEach(categoria => { %>
                                            <option value="<%=categoria._id %>"><%= categoria.nombre %></option>
                                        <% }) %>
                                        </select>
                                      </div>
                                      <div id="registroContainer"></div>
                                    <!-- Sección para las preguntas con checkboxes -->
                                    <div class="row mb-3">
                                        <div class="text-start-center">
                                            <label class="text-body" style="font-size: 25px;">Preguntas</label>
                                        <div class="col-sm-10">
                                        <br>
                                        <div id="preguntaList2">
                                        </div>
                                        <!-- Agrega más preguntas según sea necesario -->
                                      </div>
                                    </div>
                                  
                                </div>
                                <div class="modal-footer">
                                  <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
<!--                                   <button type="button" class="btn btn-primary"  onclick="handleSubmit()">Crear</button>
 -->                                </div>
                              </form>
                          </div>
                        </div>
                      </div>

                      <script>
                        document.getElementById('categoriaSelects').addEventListener('change', async function() {
                        const categoriaId = this.value;
                        const encuestaId = '66ce2a15204b900b416d0b84'
                        const response = await fetch(`/admin/listaEncuestas/${encuestaId}`); // Ajustar la ruta 
                        const {encuesta, categorias, preguntas, encpre}= await response.json();
                        
                        console.log('consultar encuesta')
                        console.log(encuesta);

                        console.log('conulstar preguntas')
                        console.log(preguntas)
                        
                        console.log('encuesta pregunta');
                        console.log(encpre)
                        const idCategoriaP = preguntas.map(pregunta => pregunta.id_categoria)
                        

                        console.log('ids categorias')
                        console.log(idCategoriaP);
                        
                        const preguntasFiltradas = idCategoriaP.filter(id => 
                          id === categoriaId
                        ); 

                        
                        console.log('Catgegorias con preguna seleccionadas')
                        console.log(preguntasFiltradas);
                        const preguntaList = document.getElementById('preguntaList2');
                        preguntaList.innerHTML = '';

                        preguntasFiltradas.forEach(pregunta => {
                          const checkbox = document.createElement('input');
                          // ... (configuración del checkbox) ...

                          // Verificar si la pregunta ya está seleccionada (usando IDs de categoría y pregunta)
                          const estaSeleccionada = encpre.some(preguntaEncuesta => 
                            preguntaEncuesta.id_encuesta === encuesta._id 
                          );

                          if (estaSeleccionada) {
                            checkbox.checked = true;
                          }

                          preguntasFiltradas.forEach(pregunta => {
                      // Crear el checkbox
                      const checkbox = document.createElement('input');
                      checkbox.type = 'checkbox';
                      checkbox.id = `pregunta-${pregunta._id}`;
                      checkbox.name = 'preguntas[]'; // Usar [] para enviar un array de IDs al servidor
                      checkbox.value = pregunta._id;

                      // Crear el label
                      const label = document.createElement('label');
                      label.htmlFor = `pregunta-${pregunta._id}`;
                      label.textContent = pregunta.nombre;
                      label.classList.add('form-check-label'); // Agregar clase para estilos (opcional)

                      // Crear un div contenedor (opcional, para mejorar el diseño)
                      const div = document.createElement('div');
                      div.classList.add('form-check'); // Agregar clase para estilos (opcional)

                      // Agregar el checkbox y el label al div contenedor
                      div.appendChild(checkbox);
                      div.appendChild(label);

                      // Agregar el div contenedor al preguntaList
                      preguntaList.appendChild(div); 
                        });
                       
                        // Filtrar preguntas por categoría
                        });
                      
                        })
                      </script>
                      <script>
                            function handleSubmit() {
                                // Combinar todas las selecciones de todas las categorías en un solo array
                                const encuestaId = document.getElementById('idEncuesta').value;
                                const allSelectedPreguntas = Object.values(selectedPreguntas).flat();

                                // Asegúrate de que el array no esté vacío
                                if (allSelectedPreguntas.length === 0) {
                                  alert('Por favor, selecciona al menos una pregunta.');
                                  return;
                                }

                                // Opcional: Convertir a JSON si el servidor espera este formato
                                const dataToSend = JSON.stringify({ 
                                  encuestaId: encuestaId,
                                  preguntasSeleccionadas: allSelectedPreguntas 
                                });

                                // Enviar la solicitud al servidor
                                fetch('/forms/nuevaEncPreg', {
                                  method: 'POST',
                                  headers: {
                                    'Content-Type': 'application/json'
                                  },
                                  body: dataToSend
                                })
                                .then(response => response.json())
                                .then(data => {
                                  //console.log('Registro exitoso:' );
                                  //recargar la pagina
                                  location.reload();
                                })
                                .catch(error => {
                                  console.error('Error al registrar las preguntas:', error);
                                  alert('Ocurrió un error al guardar las preguntas.');
                                });
                              }
                            
                      </script>